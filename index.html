<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Jeu de Nim</title>
  <!-- Ajout de Tailwind CSS -->
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    // Configuration de Tailwind (optionnel, mais bien pour les polices)
    tailwind.config = {
      theme: {
        extend: {
          fontFamily: {
            sans: ['Inter', 'system-ui', '-apple-system', 'Segoe UI', 'Roboto', 'Ubuntu', 'Helvetica Neue', 'Arial', 'sans-serif'],
          },
        },
      },
    }
  </script>
  <style>
    /* On garde ce style minimal pour les champs de l'algorigramme (foreignObject)
      car Tailwind ne peut pas les cibler directement.
    */
    .node-input {
      width: 100%;
      height: 100%;
      box-sizing: border-box;
      border: none;
      background: transparent;
      outline: none;
      resize: none;
      font-size: 16px;
      line-height: 1.2;
      padding: .35rem;
      text-align: center;
      /* On s'assure que la police correspond */
      font-family: 'Inter', sans-serif; 
      color: #1f2937;
    }
    .node-input:focus {
      box-shadow: 0 0 0 2px rgba(99, 102, 241, 0.5); /* Effet de focus indigo */
      border-radius: 4px;
    }

    /* Styles pour l'impression */
    @media print {
      #header, #toolbar-container {
        display: none !important;
      }
      body {
        background: #fff;
      }
      .sheet {
        box-shadow: none;
        border: 1px solid #e5e7eb; /* Bordure légère pour l'impression */
        padding: 1rem;
      }
      main {
        margin-top: 0;
        padding: 0;
      }
      /* Révéler toutes les étapes pour l'impression */
      .step {
        display: block !important;
      }
    }
  </style>
</head>
<body class="font-sans bg-slate-100 text-slate-900">

  <!-- En-tête amélioré -->
  <header id="header" class="bg-white shadow-sm">
    <div class="max-w-5xl mx-auto px-4 sm:px-6 lg:px-8 py-5">
      <h1 class="text-2xl sm:text-3xl font-bold tracking-tight text-slate-900">Jeu de Nim</h1>
      
      <!-- Champs Prénom/Nom -->
      <div class="mt-4 grid grid-cols-1 sm:grid-cols-2 gap-4">
        <div>
          <label for="prenom" class="block text-sm font-medium text-slate-700">Prénom :</label>
          <input id="prenom" type="text" placeholder="Votre prénom" class="mt-1 block w-full rounded-lg border-slate-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm" />
        </div>
        <div>
          <label for="nom" class="block text-sm font-medium text-slate-700">Nom :</label>
          <input id="nom" type="text" placeholder="Votre nom" class="mt-1 block w-full rounded-lg border-slate-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm" />
        </div>
      </div>

      <!-- Barre d'outils -->
      <div id="toolbar-container" class="mt-4">
        <button 
          type="button" 
          onclick="window.print()" 
          class="inline-flex items-center gap-2 rounded-lg border border-transparent bg-indigo-600 px-4 py-2 text-sm font-medium text-white shadow-sm hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2 transition-colors"
        >
          <!-- Icône SVG pour l'imprimante -->
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="w-5 h-5">
            <path fill-rule="evenodd" d="M5 2.75C5 1.784 5.784 1 6.75 1h6.5c.966 0 1.75.784 1.75 1.75v3.5a.75.75 0 0 1-1.5 0v-3.5a.25.25 0 0 0-.25-.25h-6.5a.25.25 0 0 0-.25.25v3.5a.75.75 0 0 1-1.5 0v-3.5ZM8 10.75a.75.75 0 0 1 .75-.75h2.5a.75.75 0 0 1 0 1.5h-2.5a.75.75 0 0 1-.75-.75Z" clip-rule="evenodd" />
            <path d="M3.5 6A1.5 1.5 0 0 0 2 7.5v6A1.5 1.5 0 0 0 3.5 15h13A1.5 1.5 0 0 0 18 13.5v-6A1.5 1.5 0 0 0 16.5 6h-13ZM5 7.5a.5.5 0 0 1 .5-.5h9a.5.5 0 0 1 .5.5v6a.5.5 0 0 1-.5.5h-9a.5.5 0 0 1-.5-.5v-6Z" />
            <path d="M1.5 16.75A.75.75 0 0 1 2.25 16h15.5a.75.75 0 0 1 0 1.5H2.25a.75.75 0 0 1-.75-.75Z" />
          </svg>
          Imprimer / PDF
        </button>
      </div>
    </div>
  </header>

  <main class="max-w-5xl mx-auto p-4 sm:p-6 lg:p-8 space-y-8">
    
    <!-- Bloc questions avec le stepper -->
    <section class="sheet bg-white shadow-xl rounded-2xl overflow-hidden border-t-8 border-indigo-500" id="questions">
      <div class="p-6 sm:p-8">
        <!-- Le H2 et le P de consignes ont été retirés d'ici -->
        
        <div id="stepper" class=""> <!-- J'ai retiré la classe 'mt-6' pour compenser la suppression des textes -->
          
          <!-- Base pour les boutons -->
          <style>
            .btn-primary {
              @apply inline-flex items-center rounded-lg border border-transparent bg-indigo-600 px-4 py-2 text-sm font-medium text-white shadow-sm hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2 transition-colors disabled:opacity-50 disabled:cursor-not-allowed;
            }
            .btn-secondary {
              @apply inline-flex items-center rounded-lg border border-slate-300 bg-white px-4 py-2 text-sm font-medium text-slate-700 shadow-sm hover:bg-slate-50 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2 transition-colors;
            }
          </style>

          <!-- Étape 1 -->
          <div class="step" data-step="1">
            <h3 class="text-lg font-medium text-indigo-700">Question 1</h3>
            <p class="mt-1 text-slate-600">Vous avez joué plusieurs parties contre l'ordinateur. Avez-vous remarqué quelque chose de particulier ? L'ordinateur gagne-t-il par hasard ou y a-t-il une logique ?</p>
            <textarea id="q1" rows="4" class="mt-3 block w-full rounded-lg border-slate-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm" placeholder="Ta réponse..."></textarea>
            <div class="mt-5 flex justify-end">
              <button type="button" class="btn-primary" id="s1" disabled>Valider et question suivante</button>
            </div>
          </div>
          
          <!-- Étape 2 -->
          <div class="step" data-step="2" style="display:none">
            <h3 class="text-lg font-medium text-sky-700">Question 2</h3>
            <p class="mt-1 text-slate-600">Si l'ordinateur suit une logique et ne joue pas au hasard, qu'est-ce qui lui permet de toujours prendre la bonne décision à chaque coup ?</p>
            <textarea id="q2" rows="3" class="mt-3 block w-full rounded-lg border-slate-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm" placeholder="Ta réponse..."></textarea>
            <div class="mt-5 flex justify-between">
              <button class="btn-secondary" id="b2" type="button">Précédent</button>
              <button class="btn-primary" id="s2" type="button" disabled>Valider et question suivante</button>
            </div>
          </div>
          
          <!-- Étape 3 -->
          <div class="step" data-step="3" style="display:none">
            <h3 class="text-lg font-medium text-amber-700">Question 3</h3>
            <p class="mt-1 text-slate-600">Quel mot utilise-t-on en informatique pour désigner une suite d'instructions précises qui permettent de résoudre un problème ?</p>
            <!-- Champ de saisie qui manquait -->
            <input id="q3" type="text" class="mt-3 block w-full rounded-lg border-slate-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm" placeholder="Mot attendu..." />
            <div class="mt-5 flex justify-between">
              <button class="btn-secondary" id="b3" type="button">Précédent</button>
              <button class="btn-primary" id="s3" type="button" disabled>Valider et question suivante</button>
            </div>
          </div> <!-- <-- C'EST CETTE BALISE DIV FERMANTE QUI MANQUAIT -->
          
          <!-- Étape 4 (Drag and Drop) -->
          <div class="step" data-step="4" style="display:none">
            <h3 class="text-lg font-medium text-rose-700">4. Remettre dans l’ordre</h3>
            <p class="mt-1 text-slate-600">Fais glisser les vignettes de la zone "À placer" vers la zone "Votre algorithme" pour les remettre dans le bon ordre. Tu peux les déplacer d'une zone à l'autre.</p>
            
            <div class="mt-4 grid grid-cols-1 md:grid-cols-2 gap-4">
              <!-- Source List -->
              <div>
                <h4 class="font-semibold text-slate-800 mb-2">Vignettes à placer :</h4>
                <div id="q4-source" class="space-y-2 p-3 bg-slate-50 rounded-lg min-h-[300px] border border-slate-200 transition-colors duration-150">
                  <div id="item-1" draggable="true" class="q4-item p-3 rounded-lg shadow bg-white cursor-grab active:cursor-grabbing">Poser 16 bâtons. L'adversaire commence.</div>
                  <div id="item-2" draggable="true" class="q4-item p-3 rounded-lg shadow bg-white cursor-grab active:cursor-grabbing">Tant qu'il reste au moins un bâton...</div>
                  <div id="item-3" draggable="true" class="q4-item p-3 rounded-lg shadow bg-white cursor-grab active:cursor-grabbing">L'adversaire retire 1, 2 ou 3 bâtons.</div>
                  <div id="item-4" draggable="true" class="q4-item p-3 rounded-lg shadow bg-white cursor-grab active:cursor-grabbing">Calculer le coup : 4 - (nombre pris par l'adversaire).</div>
                  <div id="item-5" draggable="true" class="q4-item p-3 rounded-lg shadow bg-white cursor-grab active:cursor-grabbing">Retirer les bâtons calculés (pour faire un total de 4).</div>
                  <div id="item-6" draggable="true" class="q4-item p-3 rounded-lg shadow bg-white cursor-grab active:cursor-grabbing">S'il reste 0 bâton, l'adversaire perd. Sinon, retour à son tour.</div>
                </div>
              </div>
              
              <!-- Target List -->
              <div>
                <h4 class="font-semibold text-slate-800 mb-2">Votre algorithme :</h4>
                <div id="q4-target" class="space-y-2 p-3 border-2 border-dashed border-slate-300 rounded-lg min-h-[300px] transition-colors duration-150">
                  <!-- Les vignettes arriveront ici -->
                </div>
              </div>
            </div>
            
            <div class="mt-5 flex justify-between">
              <button class="btn-secondary" id="b4" type="button">Précédent</button>
              <button class="btn-primary" id="s4" type="button" disabled>Valider et voir l'algorigramme</button>
            </div>
          </div>

        </div>
      </div>
    </section>

    <!-- Bloc Algorigramme (initialement caché) -->
    <section class="sheet bg-white shadow-xl rounded-2xl overflow-hidden border-t-8 border-teal-500" id="flowchart-section" style="display:none">
      <!-- Nouvelle Consigne -->
      <div class="p-6 sm:p-8 border-b border-slate-200">
        <h2 class="text-xl font-semibold text-slate-800">5. Algorigramme à compléter</h2>
        <p class="mt-2 text-slate-600">Maintenant que vous avez ordonné les étapes, complétez l'algorigramme (le schéma) ci-dessous. Utilisez les étapes de la question 4 pour vous aider à remplir les bonnes cases.</p>
      </div>
      
      <!-- L'algorigramme SVG -->
      <div class="flow-wrap p-4 sm:p-6">
        <svg viewBox="0 0 900 1200" role="img" aria-label="Algorigramme à compléter du jeu de Nim">
          <defs>
            <marker id="arrow" markerWidth="10" markerHeight="10" refX="6" refY="3" orient="auto" markerUnits="strokeWidth">
              <path d="M0,0 L0,6 L6,3 z" fill="#475569" />
            </marker>
          </defs>

          <!-- Couleurs : J'utilise des couleurs plus douces de Tailwind -->
          <!-- Formes : J'ajoute un stroke-width pour plus de clarté -->
          
          <!-- START oval (indigo) -->
          <ellipse cx="450" cy="80" rx="120" ry="40" fill="#e0e7ff" stroke="#4338ca" stroke-width="2"/>
          <foreignObject x="350" y="55" width="200" height="50">
            <div xmlns="http://www.w3.org/1999/xhtml">
              <input id="n0" class="node-input" value="Début" aria-label="Début" />
            </div>
          </foreignObject>

          <!-- Step 1 rectangle (bleu ciel) -->
          <rect x="250" y="150" width="400" height="70" rx="12" fill="#e0f2fe" stroke="#0369a1" stroke-width="2"/>
          <foreignObject x="260" y="155" width="380" height="60">
            <div xmlns="http://www.w3.org/1999/xhtml">
              <textarea id="n1" class="node-input" placeholder="Action 1..."></textarea>
            </div>
          </foreignObject>
          <line x1="450" y1="120" x2="450" y2="145" stroke="#475569" stroke-width="2" marker-end="url(#arrow)"/>

          <!-- Step 2 rectangle (bleu ciel) -->
          <rect x="250" y="250" width="400" height="70" rx="12" fill="#e0f2fe" stroke="#0369a1" stroke-width="2"/>
          <foreignObject x="260" y="255" width="380" height="60">
            <div xmlns="http://www.w3.org/1999/xhtml">
              <textarea id="n2" class="node-input" placeholder="Action 2..."></textarea>
            </div>
          </foreignObject>
          <line x1="450" y1="220" x2="450" y2="245" stroke="#475569" stroke-width="2" marker-end="url(#arrow)"/>

          <!-- Decision diamond (ambre) -->
          <polygon points="450,350 670,420 450,490 230,420" fill="#fef3c7" stroke="#b45309" stroke-width="2"/>
          <foreignObject x="300" y="385" width="300" height="70">
            <div xmlns="http://www.w3.org/1999/xhtml">
              <textarea id="n3" class="node-input" placeholder="Condition..."></textarea>
            </div>
          </foreignObject>
          <line x1="450" y1="320" x2="450" y2="345" stroke="#475569" stroke-width="2" marker-end="url(#arrow)"/>

          <!-- Right loop to top (Non) -->
          <path d="M670,420 L820,420 L820,80 L570,80" fill="none" stroke="#475569" stroke-width="2" marker-end="url(#arrow)"/>
          <text x="700" y="405" fill="#1f2937" font-size="16" font-weight="500">Non</text>

          <!-- Step 3 rectangle (bleu ciel) -->
          <rect x="250" y="520" width="400" height="70" rx="12" fill="#e0f2fe" stroke="#0369a1" stroke-width="2"/>
          <foreignObject x="260" y="525" width="380" height="60">
            <div xmlns="http://www.w3.org/1999/xhtml">
              <textarea id="n4" class="node-input" placeholder="Action si Oui..."></textarea>
            </div>
          </foreignObject>
          <line x1="450" y1="490" x2="450" y2="515" stroke="#475569" stroke-width="2" marker-end="url(#arrow)"/>
          <text x="430" y="510" fill="#1f2937" font-size="16" font-weight="500">Oui</text>

          <!-- Step 4 rectangle (bleu ciel) -->
          <rect x="250" y="620" width="400" height="70" rx="12" fill="#e0f2fe" stroke="#0369a1" stroke-width="2"/>
          <foreignObject x="260" y="625" width="380" height="60">
            <div xmlns="http://www.w3.org/1999/xhtml">
              <textarea id="n5" class="node-input" placeholder="Action..."></textarea>
            </div>
          </foreignObject>
          <line x1="450" y1="590" x2="450" y2="615" stroke="#475569" stroke-width="2" marker-end="url(#arrow)"/>

          <!-- END oval (indigo) -->
          <ellipse cx="450" cy="740" rx="120" ry="40" fill="#e0e7ff" stroke="#4338ca" stroke-width="2"/>
          <foreignObject x="350" y="715" width="200" height="50">
            <div xmlns="http://www.w3.org/1999/xhtml">
              <input id="n6" class="node-input" value="Fin" />
            </div>
          </foreignObject>
          <line x1="450" y1="690" x2="450" y2="715" stroke="#475569" stroke-width="2" marker-end="url(#arrow)"/>
        </svg>
      </div>
    </section>
  </main>

  <!-- Le script JS est identique et n'a pas besoin d'être modifié -->
  <script>
    // Navigation par étapes : nécessite une réponse pour avancer
    document.addEventListener('DOMContentLoaded', () => {
      const steps = [1,2,3,4];
      let current = 1;
      
      function show(step){
        document.querySelectorAll('.step').forEach(el=>el.style.display='none');
        const tgt = document.querySelector(`.step[data-step="${step}"]`);
        if(tgt) tgt.style.display='block';
        current = step;
      }
      
      function enableWhenFilled(id, btnId){
        const el = document.getElementById(id);
        const btn = document.getElementById(btnId);
        const handler = () => { btn.disabled = !(el.value && el.value.trim().length>0); };
        el.addEventListener('input', handler);
        handler();
      }
      
      // Init visibility: only Q1 visible
      show(1);
      
      // Wiring
      enableWhenFilled('q1','s1');
      document.getElementById('s1').addEventListener('click',()=>show(2));

      enableWhenFilled('q2','s2');
      document.getElementById('b2').addEventListener('click',()=>show(1));
      document.getElementById('s2').addEventListener('click',()=>show(3));

      enableWhenFilled('q3','s3');
      document.getElementById('b3').addEventListener('click',()=>show(2));
      document.getElementById('s3').addEventListener('click',()=>show(4));

      // enableWhenFilled('q4','s4'); // Supprimé et remplacé par la logique drag-and-drop
      document.getElementById('b4').addEventListener('click',()=>show(3));

      // ---- NOUVEL AJOUT (Q4 DRAG & DROP) ----
      
      const q4Source = document.getElementById('q4-source');
      const q4Target = document.getElementById('q4-target');
      const s4Button = document.getElementById('s4');

      let draggedItem = null;

      // Écouteur global pour le début et la fin du drag
      document.addEventListener('dragstart', (e) => {
        // S'assurer qu'on drague une vignette
        if (e.target.classList.contains('q4-item')) {
          draggedItem = e.target;
          // Ajoute une opacité légère à l'élément qu'on déplace
          setTimeout(() => e.target.classList.add('opacity-50'), 0);
        }
      });

      document.addEventListener('dragend', (e) => {
        if (draggedItem) {
          // Retire l'opacité quand on lâche
          draggedItem.classList.remove('opacity-50');
          draggedItem = null;
        }
      });

      // Ajoute les écouteurs sur les deux zones (source et cible)
      [q4Source, q4Target].forEach(zone => {
        zone.addEventListener('dragover', (e) => {
          e.preventDefault(); // Nécessaire pour autoriser le drop
          // Style visuel pour indiquer une zone de drop valide
          zone.classList.add('bg-slate-100', 'border-indigo-300');
        });

        zone.addEventListener('dragleave', (e) => {
          // Retire le style visuel
          zone.classList.remove('bg-slate-100', 'border-indigo-300');
        });

        zone.addEventListener('drop', (e) => {
          e.preventDefault();
          if (draggedItem) {
            // S'assure qu'on ne drop pas sur l'item lui-même
            if (e.target === draggedItem) {
               zone.classList.remove('bg-slate-100', 'border-indigo-300');
               return;
            }
            
            // Si on drop sur une autre vignette, on l'ajoute à la fin de la liste parente
            if (e.target.classList.contains('q4-item')) {
                 e.target.parentElement.appendChild(draggedItem);
            } else {
                 // Si on drop sur la zone elle-même, on l'ajoute
                 zone.appendChild(draggedItem);
            }
          }
          zone.classList.remove('bg-slate-100', 'border-indigo-300');

          // Vérifier si la source est vide pour activer le bouton
          // Le bouton est activé seulement si toutes les vignettes sont dans la zone cible
          s4Button.disabled = (q4Source.children.length > 0);
        });
      });

      // Action du bouton S4 pour afficher l'algorigramme
      s4Button.addEventListener('click', () => {
        const flowchart = document.getElementById('flowchart-section');
        flowchart.style.display = 'block';
        // Fait défiler la page pour voir la nouvelle section
        flowchart.scrollIntoView({ behavior: 'smooth', block: 'start' });
        
        // Change le bouton après clic
        s4Button.disabled = true;
        s4Button.innerHTML = `
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16" fill="currentColor" class="w-4 h-4 mr-1 -ml-1">
            <path fill-rule="evenodd" d="M12.416 3.376a.75.75 0 0 1 .208 1.04l-5 7.5a.75.75 0 0 1-1.154.114l-3-3a.75.75 0 0 1 1.06-1.06l2.35 2.35 4.516-6.774a.75.75 0 0 1 1.04-.208Z" clip-rule="evenodd" />
          </svg>
          Algorigramme affiché !`;
      });
      
      // ---- FIN DE L'AJOUT ----

      // Impression : tout révéler, puis revenir à l'étape courante
      // Note: Le style @media print gère maintenant l'affichage des étapes
      // mais on garde le 'afterprint' pour restaurer l'étape active.
      window.addEventListener('afterprint', () => { show(current); });
    });
  </script>
</body>
</html>
